<!DOCTYPE html>
<html lang="en">
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

<script>
    var baseurl = "http://localhost:8000/analyze";

    async function analyzePage() {
        var inputVal = document.getElementById("inputUrl").value;
        if (inputVal != "") {
            if (confirm(inputVal)) {
                var mainContainer = document.getElementById("responseViewport");
                mainContainer.innerHTML = "";

                const response = await fetch(baseurl, {
                    method: "POST",
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        url: inputVal
                    })
                });


                const actualResponse = await response.json().then(data => {
                    if (data.success) {
                        var title = document.createElement("div");
                        title.innerHTML = "Title of the document : " + data.result.title;
                        mainContainer.appendChild(title);

                        var htmlVersion = document.createElement("div");
                        htmlVersion.innerHTML = "HTML Version : " + data.result.html_version;
                        mainContainer.appendChild(htmlVersion);

                        var loginExist = document.createElement("div");
                        loginExist.innerHTML = "Login form exist : " + data.result.login_exist;
                        mainContainer.appendChild(loginExist);

                        var h1 = document.createElement("div");
                        h1.innerHTML = "H1 tags : " + data.result.h1;
                        mainContainer.appendChild(h1);

                        var h2 = document.createElement("div");
                        h2.innerHTML = "H2 tags : " + data.result.h2;
                        mainContainer.appendChild(h2);

                        var h3 = document.createElement("div");
                        h3.innerHTML = "H3 tags : " + data.result.h3;
                        mainContainer.appendChild(h3);

                        var h4 = document.createElement("div");
                        h4.innerHTML = "H4 tags : " + data.result.h4;
                        mainContainer.appendChild(h4);

                        var h5 = document.createElement("div");
                        h5.innerHTML = "H5 tags : " + data.result.h5;
                        mainContainer.appendChild(h5);

                        var h6 = document.createElement("div");
                        h6.innerHTML = "H6 tags : " + data.result.h6;
                        mainContainer.appendChild(h6);

                        var table = document.createElement("table")
                        table.className = "table table-dark"
                        table.innerHTML = "<tr><th>Link</th><th>Is internal</th><th>Is Reachable</th></tr>"

                        data.result.internal_links.forEach(element => {
                            table.innerHTML += "<tr><td>" + element.url + "</td><td>true</td><td>" + element.accessible + "</td></tr>"
                        });

                        data.result.external_links.forEach(element => {
                            table.innerHTML += "<tr><td>" + element.url + "</td><td>false</td><td>" + element.accessible + "</td></tr>"
                        });

                        mainContainer.append(table)

                    }
                    else {
                        var error = document.createElement("div");
                        error.innerHTML = data.error;
                        mainContainer.appendChild(error);
                    }
                });


            }
        }
        else {
            alert("Please enter a URL in the text field to continue..")
        }
    };
</script>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello</title>
</head>

<body>
    <div class="container-fluid">
        <h1>Welcome to URL scraper!</h1>
        <p>Please input a weblink to analyze!</p>
        <input type="text" id="inputUrl" name="fname" style="width: 200px;"><br><br>
        <input type="submit" value="Submit" onclick="analyzePage()">
    </div>
    <div class="container-fluid text-left">
        <div id="responseViewport" width="40"></div>
    </div>
</body>

</html>